[gcode_macro EXTRUDE]
gcode:
  {% if printer.extruder.can_extrude|lower != 'true' %}
    RESPOND TYPE=error MSG="Extruder not hot enough"
  {% else %}
    {% set length = params.LENGTH|default(0)|float %}
    {% set feedrate = params.SPEED|default(printer.firmware_retraction.retract_speed)|int * 60 %}
    M83 ;Relative extrusion
    G1 E{length} F{feedrate}
  {% endif %}

[gcode_macro RETRACT]
gcode:
  {% set length = params.LENGTH|default(printer.firmware_retraction.retract_speed)|float %}
  EXTRUDE 

[gcode_macro UNRETRACT]
gcode:
    G11
