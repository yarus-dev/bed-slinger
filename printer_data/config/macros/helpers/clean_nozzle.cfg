# These parameters define the size of the brush. Update as necessary. A visual reference is provided below. Note that orientation of 
# parameters remain the same whether bucket is at rear or front.
# 
#                  ←   brush_width   →                            
#                   _________________                                                          ↑
#                  |                 |  ↑                     If you chose location_bucket_rear = True, Y position is acquired
#  brush_start (x) |                 | brush_depth            from your stepper_y position_max. Adjust your brush physically in
#                  |_________________|  ↓                               Y so that the nozzle scrubs within the brush.       
#                          (y)                                                                 ↓
#                      brush_front
# __________________________________________________________

[gcode_macro clean_nozzle]
variable_brush_top:  4.5
variable_brush_deep: -2.5  
variable_brush_start: -2
variable_brush_front: 220  
variable_brush_width: 36.7
variable_brush_depth: 7.9
variable_brush_segments: 14    
gcode:
  RESPOND MSG="clean nozzle"
  SAVE_GCODE_STATE NAME=_clean_nozzle
  RESTORE_GCODE_STATE NAME=_CLEAN_NOZZLE



[gcode_macro CLEAN_NOZZLE]
variable_start_x: -2
variable_start_y: 222
variable_start_z: 3.3
variable_safe_z: 6
variable_wipe_dist: 35
variable_wipe_height: 3.0
variable_wipe_qty: 5
gcode:
  RESPOND MSG="clean nozzle"
  SAVE_GCODE_STATE NAME=_CLEAN_NOZZLE
  G90
  G1 Z{safe_z} F1800
  M400
  G1 X{start_x} Y{start_y} F24000
  G1 Z{start_z} F1800
  M400
  RETRACT
  {% for wipes in range(1, (wipe_qty + 1)) %}
    G1 X{start_x + wipe_dist} F24000
    G1 Y{start_y + wipe_height} F24000
    M400
    G1 X{start_x} F24000
    G1 Y{start_y} F24000
    M400
  {% endfor %}
  G1 X{start_x} Y{start_y} F24000
  G1 Z{safe_z}  F1800
  RESTORE_GCODE_STATE NAME=_CLEAN_NOZZLE
