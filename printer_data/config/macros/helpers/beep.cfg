[gcode_macro BEEP]
gcode:
  {% set frequency = params.FREQUENCY|default(2000)|int %} ; Frequency in Hz. Default 2kHz.
  {% set duration  = params.DURATION|default(100)|int %}  ; Duration/wait of each beep in ms. Default 100ms.
  SET_PIN PIN=beeper VALUE=0.8 CYCLE_TIME={ 1.0/frequency if frequency > 0 else 1 }
  G4 P{duration}
  SET_PIN PIN=beeper VALUE=0

[gcode_macro M300]
gcode:
  {% set frequency = params.S|float %}
  {% set duration = params.P|float %}
  BEEP FREQUENCY={frequency} DURATION={duration}