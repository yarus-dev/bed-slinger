[gcode_macro BEEP]
gcode:
  {% set frequency = params.FREQUENCY|default(2000)|int %}; Frequency in Hz. Default 2kHz.
  {% set duration  = params.DURATION |default(100) |int %}; Duration of each beep in ms. Default 100ms.
  {% set wait      = params.WAIT     |default(100) |int %}; Wait after beep in ms. Default 100ms.
  
  SET_PIN PIN=beeper VALUE={frequency}
  G4 P{duration}
  SET_PIN PIN=beeper VALUE=0
  G4 P{wait}


[gcode_macro M300]
gcode:
  {% set frequency =  %}
  {% set duration =  %}
  {% set wait      =  %}
  BEEP FREQUENCY={params.S|default(1000)|int} DURATION={params.P|default(100)|int} WAIT=
  SET_PIN PIN=BEEPER_pin VALUE={S}
  G4 P{P}
  SET_PIN PIN=BEEPER_pin VALUE=0