[gcode_macro PAUSE]
description: Pause the print and park
rename_existing: _BASE_PAUSE
gcode:
  {% if printer.pause_ _TIMELAPSE_.is_paused %}
    RESPOND MSG="Print is already paused"
  {% else %}
    SAVE_GCODE_STATE NAME=PAUSE_STATE
    _BASE_PAUSE
    _TIMELAPSE_PAUSE
    RETRACT
    STEP_ASIDE_SON
    RESPOND MSG="Pausing print..."
  {% endif %}

[gcode_macro  _TIMELAPSE_]
rename_existing: _BASE_ _TIMELAPSE_
description:  _TIMELAPSE_ the print after an optional unretract
gcode:
  RESTORE_GCODE_STATE NAME=PAUSE_STATE MOVE=1
  UNRETRACT
  _TIMELAPSE_ _TIMELAPSE_
  _BASE_ _TIMELAPSE_
  CLEAR_PAUSE
  
[gcode_macro CANCEL_PRINT]
description: Cancels the current print.
rename_existing: _BASE_CANCEL_PRINT
gcode:
  RESPOND MSG="Print canceled, Master Yar."
  CLEAR_PAUSE
  SET_PAUSE_NEXT_LAYER ENABLE=0
  SET_PAUSE_AT_LAYER   ENABLE=0 LAYER=0
  _BASE_CANCEL_PRINT
  _PRINT_END
