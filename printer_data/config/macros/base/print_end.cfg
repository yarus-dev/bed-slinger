[gcode_macro _PRINT_END]
description: ending script
gcode:
  {% set vars = printer.save_variables.variables %}
  {% set tip = |float %}
  G91 ;Relative positionning 
  G1 X-2 Y2 Z0.2 E-{vars.tip|float} F{8*60} 

  G1 X5 Y5 F3000 ;Wipe out 
  STEP_ASIDE_SON
  G90 ;Absolute positionning 

  _RESET_CONTEXT

  BED_MESH_CLEAR
  _TIMELAPSE_END
  {% if 'virtual_sdcard' in printer and not printer.virtual_sdcard.is_active %}SDCARD_RESET_FILE{% endif %}
  
  M84 X E ;Disable all steppers but Z

  BEEP
  BEEP
  RESPOND MSG="Print finished, Master Yar."